<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Desempenho de Chamadas (Sem Neutras)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plugin para exibir r√≥tulos de dados diretamente nos gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* Nova classe para o gr√°fico de Comparativo de Qualidade por Dia */
        .quality-trend-chart-container {
            height: 400px; /* Aumenta a altura para dar mais espa√ßo aos r√≥tulos acima das barras */
            max-height: 500px;
        }

        .kpi-box {
            background-color: #f8fafc;
            border-left: 5px solid;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .kpi-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .flag-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 8px;
            vertical-align: middle;
        }
        /* Estilo para o √≠cone do dia da semana */
        .day-icon {
            position: absolute;
            top: 1rem; /* 16px */
            right: 1rem; /* 16px */
            background-color: #334155; /* Cor de fundo escura */
            color: #ffffff; /* Cor do texto branca */
            border-radius: 9999px; /* Totalmente arredondado */
            width: 2.5rem; /* 40px */
            height: 2.5rem; /* 40px */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem; /* 12px */
            font-weight: bold;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
    </style>
    
    
    
    
    
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-2xl md:text-3xl font-extrabold text-slate-900">An√°lise de Desempenho de Chamadas</h1>
            <p class="text-slate-600 mt-1">Per√≠odo de An√°lise: 15/07/2025 a 21/07/2025 (Excluindo Neutras)</p>
            <div class="mt-4 flex flex-wrap items-center justify-center sm:justify-start gap-4">
                <span class="text-slate-700 text-sm md:text-base">POC para:</span>
                <img src="https://placehold.co/70x25/8a05be/ffffff?text=Nubank" onerror="this.onerror=null;this.src='https://placehold.co/70x25/cccccc/000000?text=Nubank';" alt="Logo Nubank" class="h-7 rounded-md">
                <span class="text-slate-700 text-sm md:text-base">Realizado por:</span>
                <img src="https://placehold.co/70x25/000000/ffffff?text=Mutant" onerror="this.onerror=null;this.src='https://placehold.co/70x25/cccccc/000000?text=Mutant';" alt="Logo Mutant" class="h-7 rounded-md">
                <img src="https://placehold.co/70x25/000000/ffffff?text=Intervalor" onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=IV';" alt="Logo Intervalor" class="h-7 rounded-md">
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        
        <section id="overview" class="mb-12">
            <h2 class="text-2xl font-bold mb-2 text-center">Vis√£o Geral do Per√≠odo</h2>
            <p class="text-center text-slate-600 max-w-3xl mx-auto mb-8">
                Uma vis√£o consolidada do desempenho das 76 chamadas ativas (n√£o neutras) recebidas nos cinco dias. Os dados mostram a distribui√ß√£o geral da qualidade e destacam as principais m√©tricas do per√≠odo.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center mb-10">
                <div class="kpi-box p-6 rounded-lg shadow-sm" style="border-color: #4A86D9;">
                    <p class="text-4xl font-extrabold text-slate-900">76</p>
                    <p class="text-slate-600 font-medium">Total de Liga√ß√µes Ativas</p>
                </div>
                <div class="kpi-box p-6 rounded-lg shadow-sm" style="border-color: #6ED3B3;">
                    <p class="text-4xl font-extrabold text-slate-900">47 <span class="text-xl font-semibold text-slate-700">(61.8%)</span></p>
                    <p class="text-slate-600 font-medium">Boas</p>
                </div>
                <div class="kpi-box p-6 rounded-lg shadow-sm" style="border-color: #F9A646;">
                    <p class="text-4xl font-extrabold text-slate-900">11 <span class="text-xl font-semibold text-slate-700">(14.5%)</span></p>
                    <p class="text-slate-600 font-medium">M√©dias</p>
                </div>
                <div class="kpi-box p-6 rounded-lg shadow-sm" style="border-color: #F46E6E;">
                    <p class="text-4xl font-extrabold text-slate-900">18 <span class="text-xl font-semibold text-slate-700">(23.7%)</span></p>
                    <p class="text-slate-600 font-medium">Ruins</p>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                 <h3 class="text-xl font-bold mb-4 text-center">Distribui√ß√£o Geral da Qualidade (Ativas)</h3>
                <div class="chart-container h-80 md:h-96">
                    <canvas id="overallQualityChart"></canvas>
                </div>
            </div>
        </section>

        <section id="call-classifications" class="mb-12">
            <h2 class="text-2xl font-bold mb-2 text-center">Classifica√ß√£o das Chamadas</h2>
            <p class="text-center text-slate-600 max-w-3xl mx-auto mb-8">
                Entenda os crit√©rios utilizados para classificar a qualidade das chamadas, desde as intera√ß√µes mais fluidas at√© aquelas com desafios t√©cnicos ou de comunica√ß√£o.
            </p>
            <div class="bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto">
                <ul class="space-y-4">
                    <li>
                        <h4 class="font-bold text-slate-900 text-lg">Boas</h4>
                        <p class="text-slate-600">Chamadas que seguiram jornadas com fluidez nos diversos caminhos do Bot, incluindo fechamento de acordo, apresenta√ß√£o de hierarquias de propostas, alega√ß√µes de pagamento, tentativas de manipula√ß√µes, etc.</p>
                    </li>
                    <li>
                        <h4 class="font-bold text-slate-900 text-lg">M√©dias</h4>
                        <p class="text-slate-600">Chamadas que seguiram os fluxos consistentes, por√©m com pontos de melhorias (situa√ß√µes n√£o previstas, falhas de captura de STT que n√£o prejudicaram as conversa√ß√µes, etc.).</p>
                    </li>
                    <li>
                        <h4 class="font-bold text-slate-900 text-lg">Ruins</h4>
                        <p class="text-slate-600">Chamadas com falhas na identifica√ß√£o, alucina√ß√µes, problemas no framework, etc.</p>
                    </li>
                </ul>
            </div>
        </section>

        <section id="daily-analysis" class="mb-12">
            <h2 class="text-2xl font-bold mb-2 text-center">An√°lise Di√°ria Detalhada (Chamadas Ativas)</h2>
            <p class="text-center text-slate-600 max-w-3xl mx-auto mb-8">
                An√°lise aprofundada do desempenho de cada dia, detalhando a qualidade das chamadas e a distribui√ß√£o por idioma, excluindo as liga√ß√µes neutras.
            </p>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8"> <!-- Alterado para 5 colunas -->
                
                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col relative"> <!-- Adicionado 'relative' aqui -->
                    <div class="day-icon">TER</div> <!-- √çcone do dia da semana -->
                    <h3 class="text-xl font-bold mb-1">15 de Julho de 2025 (Ter√ßa-feira)</h3>
                    <!-- Novo KPI Box para o total di√°rio -->
                    <div class="kpi-box p-3 rounded-lg shadow-sm mb-4 text-center" style="border-color: #4A86D9;">
                        <p class="text-2xl font-extrabold text-slate-900" id="totalDaily15">23</p>
                        <p class="text-slate-600 font-medium text-sm">Liga√ß√µes Ativas</p>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="dailyChart15"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col relative"> <!-- Adicionado 'relative' aqui -->
                    <div class="day-icon">QUA</div> <!-- √çcone do dia da semana -->
                    <h3 class="text-xl font-bold mb-1">16 de Julho de 2025 (Quarta-feira)</h3>
                    <!-- Novo KPI Box para o total di√°rio -->
                    <div class="kpi-box p-3 rounded-lg shadow-sm mb-4 text-center" style="border-color: #4A86D9;">
                        <p class="text-2xl font-extrabold text-slate-900" id="totalDaily16">27</p>
                        <p class="text-slate-600 font-medium text-sm">Liga√ß√µes Ativas</p>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="dailyChart16"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col relative"> <!-- Adicionado 'relative' aqui -->
                    <div class="day-icon">QUI</div> <!-- √çcone do dia da semana -->
                    <h3 class="text-xl font-bold mb-1">17 de Julho de 2025 (Quinta-feira)</h3>
                    <!-- Novo KPI Box para o total di√°rio -->
                    <div class="kpi-box p-3 rounded-lg shadow-sm mb-4 text-center" style="border-color: #4A86D9;">
                        <p class="text-2xl font-extrabold text-slate-900" id="totalDaily17">17</p>
                        <p class="text-slate-600 font-medium text-sm">Liga√ß√µes Ativas</p>
                    </div>
                     <div class="chart-container flex-grow">
                        <canvas id="dailyChart17"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col relative"> <!-- Adicionado 'relative' aqui -->
                    <div class="day-icon">SEX</div> <!-- √çcone do dia da semana -->
                    <h3 class="text-xl font-bold mb-1">18 de Julho de 2025 (Sexta-feira)</h3>
                    <!-- Novo KPI Box para o total di√°rio -->
                    <div class="kpi-box p-3 rounded-lg shadow-sm mb-4 text-center" style="border-color: #4A86D9;">
                        <p class="text-2xl font-extrabold text-slate-900" id="totalDaily18">7</p>
                        <p class="text-slate-600 font-medium text-sm">Liga√ß√µes Ativas</p>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="dailyChart18"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col relative"> <!-- Adicionado 'relative' aqui -->
                    <div class="day-icon">SEG</div> <!-- √çcone do dia da semana -->
                    <h3 class="text-xl font-bold mb-1">21 de Julho de 2025 (Segunda-feira)</h3>
                    <!-- Novo KPI Box para o total di√°rio -->
                    <div class="kpi-box p-3 rounded-lg shadow-sm mb-4 text-center" style="border-color: #4A86D9;">
                        <p class="text-2xl font-extrabold text-slate-900" id="totalDaily21">2</p>
                        <p class="text-slate-600 font-medium text-sm">Liga√ß√µes Ativas</p>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="dailyChart21"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="trends" class="mb-12">
             <h2 class="text-2xl font-bold mb-2 text-center">Tend√™ncias e Evolu√ß√£o (Chamadas Ativas)</h2>
            <p class="text-center text-slate-600 max-w-3xl mx-auto mb-8">
                Visualiza√ß√£o da evolu√ß√£o do volume e da qualidade das chamadas ativas ao longo dos cinco dias, revelando padr√µes e mudan√ßas importantes no desempenho.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">Evolu√ß√£o do Volume Total de Liga√ß√µes Ativas</h3>
                    <div class="chart-container">
                        <canvas id="totalCallsTrendChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">Comparativo de Qualidade por Dia (Ativas)</h3>
                    <div class="chart-container quality-trend-chart-container"> <!-- Adicionada classe espec√≠fica -->
                        <canvas id="qualityTrendChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="language-analysis" class="mb-12">
            <h2 class="text-2xl font-bold mb-2 text-center">An√°lise de Idiomas nas Chamadas "Boas"</h2>
            <p class="text-center text-slate-600 max-w-3xl mx-auto mb-8">
                Foco nas chamadas de alta qualidade para entender a contribui√ß√£o de cada idioma. Notamos um crescimento significativo na participa√ß√£o do ESCO no √∫ltimo dia.
            </p>
            <div class="bg-white rounded-lg shadow-md p-6 md:w-2/3 lg:w-1/2 mx-auto">
                <h3 class="text-xl font-bold mb-4 text-center">Distribui√ß√£o de Idiomas (Chamadas Boas)</h3>
                <div class="chart-container">
                    <canvas id="goodCallsLangChart"></canvas>
                </div>
            </div>
        </section>

        <section id="flag-legend" class="mb-12">
            <h2 class="text-2xl font-bold mb-2 text-center">Legenda de Idiomas</h2>
            <p class="text-center text-slate-600 max-w-3xl mx-auto mb-8">
                Identifica√ß√£o visual dos idiomas presentes nas chamadas.
            </p>
            <div class="bg-white rounded-lg shadow-md p-6 max-w-md mx-auto">
                <ul class="space-y-3">
                    <li class="flex items-center text-slate-700">
                        <img src="https://flagsapi.com/BR/flat/20.png" onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=BR';" alt="Bandeira do Brasil" class="flag-icon">
                        <span class="font-medium">PTBR: Portugu√™s (Brasil)</span>
                    </li>
                    <li class="flex items-center text-slate-700">
                        <img src="https://flagsapi.com/CO/flat/20.png" onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=CO';" alt="Bandeira da Col√¥mbia" class="flag-icon">
                        <span class="font-medium">ESCO: Espanhol (Col√¥mbia)</span>
                    </li>
                    <li class="flex items-center text-slate-700">
                        <img src="https://flagsapi.com/MX/flat/20.png" onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=MX';" alt="Bandeira do M√©xico" class="flag-icon">
                        <span class="font-medium">ESMX: Espanhol (M√©xico)</span>
                    </li>
                </ul>
            </div>
        </section>

        <section id="recommendations" class="mb-12">
            <h2 class="text-2xl font-bold mb-2 text-center">Recomenda√ß√µes e Pr√≥ximos Passos</h2>
            <p class="text-center text-slate-600 max-w-3xl mx-auto mb-8">
                Com base na an√°lise dos dados, as seguintes a√ß√µes foram tomadas ou est√£o em andamento para otimizar o desempenho futuro da equipe.
            </p>
            <div class="max-w-4xl mx-auto">
                <ul class="space-y-4">
                    <li class="bg-white p-5 rounded-lg shadow-sm flex items-start space-x-4">
                        <span class="text-2xl text-sky-500">‚úÖ</span>
                        <div>
                            <h4 class="font-bold text-slate-900">Queda de Volume e Chamadas Neutras</h4>
                            <p class="text-slate-600">A causa da queda de volume foi identificada: as chamadas em caixa postal foram removidas do discador, o que impactou diretamente o total de liga√ß√µes neutras.</p>
                        </div>
                    </li>
                    <li class="bg-white p-5 rounded-lg shadow-sm flex items-start space-x-4">
                        <span class="text-2xl text-emerald-500">üí°</span>
                        <div>
                            <h4 class="font-bold text-slate-900">Replicar as Melhores Pr√°ticas</h4>
                            <p class="text-slate-600">Estudar as chamadas "Boas" do dia 17, especialmente as de ESCO, para identificar e disseminar as pr√°ticas que levaram ao sucesso.</p>
                        </div>
                    </li>
                    <li class="bg-white p-5 rounded-lg shadow-sm flex items-start space-x-4">
                         <span class="text-2xl text-amber-500">üìà</span>
                        <div>
                            <h4 class="font-bold text-slate-900">Foco em Chamadas M√©dias e Ruins</h4>
                            <p class="text-slate-600">Os principais pontos negativos j√° foram identificados e tratativas foram adicionadas, resultando em uma melhora percebida no dia 17, mesmo com um volume de chamadas mais baixo.</p>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

    </main>

    <footer class="text-center p-6 mt-12 bg-slate-100">
        <p class="text-slate-500">Infogr√°fico gerado em 18 de Julho de 2025.</p>
    </footer>

    <script>
        // Registrar o plugin datalabels globalmente
        Chart.register(ChartDataLabels);

        const colorPalette = {
            good: '#6ED3B3',
            medium: '#F9A646',
            bad: '#F46E6E',
        };

        const langColors = {
            ptbr: '#003f5c',
            esco: '#7a5195',
            esmx: '#ef5675',
        };

        // Totais de chamadas ativas por dia, para c√°lculo de percentual em gr√°ficos di√°rios
        const dailyActiveTotals = {
            'dailyChart15': 23, // 12 Boas + 3 M√©dias + 8 Ruins
            'dailyChart16': 27, // 14 Boas + 5 M√©dias + 8 Ruins
            'dailyChart17': 17,  // 14 Boas + 2 M√©dias + 1 Ruim
            'dailyChart18': 7,   // 5 Boas + 1 M√©dia + 1 Ruim
            'dailyChart21': 2    // 2 Boas + 0 M√©dias + 0 Ruins
        };

        // Objeto para mapear datas aos totais ativos para o gr√°fico de tend√™ncia de qualidade
        const dailyTotalsByDate = {
            '15/07': {total: 23, day: 'Ter√ßa-feira', abbr: 'TER'},
            '16/07': {total: 27, day: 'Quarta-feira', abbr: 'QUA'},
            '17/07': {total: 17, day: 'Quinta-feira', abbr: 'QUI'},
            '18/07': {total: 7, day: 'Sexta-feira', abbr: 'SEX'},
            '21/07': {total: 2, day: 'Segunda-feira', abbr: 'SEG'}
        };

        // --- Defini√ß√£o dos dados dos gr√°ficos ---
        const overallQualityData = {
            labels: ['Boas', 'M√©dias', 'Ruins'],
            datasets: [{
                label: 'Qualidade das Liga√ß√µes',
                data: [47, 11, 18], // Atualizado para incluir dia 21 (45+2=47)
                backgroundColor: [
                    colorPalette.good,
                    colorPalette.medium,
                    colorPalette.bad,
                ],
                borderColor: '#ffffff',
                borderWidth: 2,
                hoverOffset: 4
            }]
        };

        const dailyChartData15 = {
            labels: ['Boas', 'M√©dias', 'Ruins'],
            datasets: [
                { label: 'üáßüá∑ PTBR', data: [11, 2, 6], backgroundColor: langColors.ptbr },
                { label: 'üá®üá¥ ESCO', data: [1, 1, 2], backgroundColor: langColors.esco },
                { label: 'üá≤üáΩ ESMX', data: [0, 0, 0], backgroundColor: langColors.esmx }
            ]
        };

        const dailyChartData16 = {
            labels: ['Boas', 'M√©dias', 'Ruins'],
            datasets: [
                { label: 'üáßüá∑ PTBR', data: [11, 4, 7], backgroundColor: langColors.ptbr },
                { label: 'üá®üá¥ ESCO', data: [3, 1, 1], backgroundColor: langColors.esco }
            ]
        };

        const dailyChartData17 = {
            labels: ['Boas', 'M√©dias', 'Ruins'],
            datasets: [
                { label: 'üáßüá∑ PTBR', data: [8, 2, 1], backgroundColor: langColors.ptbr },
                { label: 'üá®üá¥ ESCO', data: [6, 0, 0], backgroundColor: langColors.esco }
            ]
        };

        const dailyChartData18 = { // Novos dados para 18/07
            labels: ['Boas', 'M√©dias', 'Ruins'],
            datasets: [
                { label: 'üáßüá∑ PTBR', data: [5, 1, 0], backgroundColor: langColors.ptbr },
                { label: 'üá®üá¥ ESCO', data: [0, 0, 0], backgroundColor: langColors.esco },
                { label: 'üá≤üáΩ ESMX', data: [0, 0, 1], backgroundColor: langColors.esmx }
            ]
        };

        const dailyChartData21 = { // Novos dados para 21/07
            labels: ['Boas', 'M√©dias', 'Ruins'],
            datasets: [
                { label: 'üáßüá∑ PTBR', data: [2, 0, 0], backgroundColor: langColors.ptbr },
                { label: 'üá®üá¥ ESCO', data: [0, 0, 0], backgroundColor: langColors.esco },
                { label: 'üá≤üáΩ ESMX', data: [0, 0, 0], backgroundColor: langColors.esmx }
            ]
        };

        const totalCallsTrendData = {
            labels: ['15/07', '16/07', '17/07', '18/07', '21/07'], // Atualizado
            datasets: [{
                label: 'Total de Liga√ß√µes por Dia',
                data: [23, 27, 17, 7, 2], // Atualizado
                fill: true,
                backgroundColor: 'rgba(74, 134, 217, 0.2)',
                borderColor: 'rgba(74, 134, 217, 1)',
                tension: 0.1,
                pointBackgroundColor: 'rgba(74, 134, 217, 1)',
                pointBorderColor: '#fff',
                pointHoverRadius: 7,
            }]
        };

        const qualityTrendData = {
            labels: ['15/07', '16/07', '17/07', '18/07', '21/07'].map(date => `${date}\n(${dailyTotalsByDate[date].total})`), // Adiciona total de liga√ß√µes
            datasets: [
                { label: 'Boas', data: [12, 14, 14, 5, 2], backgroundColor: colorPalette.good }, // Atualizado
                { label: 'M√©dias', data: [3, 5, 2, 1, 0], backgroundColor: colorPalette.medium }, // Atualizado
                { label: 'Ruins', data: [8, 8, 1, 1, 0], backgroundColor: colorPalette.bad }, // Atualizado
            ]
        };

        const goodCallsLangData = {
            labels: ['üáßüá∑ PTBR', 'üá®üá¥ ESCO'],
            datasets: [{
                label: 'Idioma',
                data: [37, 10], // Atualizado: PTBR (35+2=37), ESCO (10+0=10)
                backgroundColor: [langColors.ptbr, langColors.esco],
                borderColor: '#ffffff',
                borderWidth: 2,
                hoverOffset: 4
            }]
        };
        // --- Fim da defini√ß√£o dos dados dos gr√°ficos ---


        function wrapLabels(label) {
            const maxLen = 16;
            if (typeof label !== 'string' || label.length <= maxLen) {
                return label;
            }
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            for (const word of words) {
                if ((currentLine + ' ' + word).length > maxLen && currentLine.length > 0) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine += (currentLine.length === 0 ? '' : ' ') + word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                // Para tooltips, queremos a data sem o total de liga√ß√µes
                return label[0]; 
            }
            return label;
        };
        
        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        title: tooltipTitleCallback,
                        label: function(tooltipItem) {
                            const dataset = tooltipItem.dataset;
                            const currentValue = tooltipItem.raw;
                            let totalForPercentage = 0;
                            let labelText = '';

                            if (tooltipItem.chart.config.type === 'doughnut' || tooltipItem.chart.config.type === 'pie') {
                                totalForPercentage = dataset.data.reduce((sum, val) => sum + val, 0);
                                labelText = tooltipItem.label; // Category name for pie/doughnut
                            } else if (tooltipItem.chart.config.type === 'bar') {
                                const dataIndex = tooltipItem.dataIndex; // Index of the quality category (Boas, M√©dias, Ruins)
                                const scalesOptions = tooltipItem.chart.options.scales;
                                const xAxisOptions = scalesOptions && scalesOptions.x ? scalesOptions.x : undefined; // Acessa x de forma segura
                                const isStacked = xAxisOptions ? xAxisOptions.stacked : false; // Acessa stacked de forma segura

                                if (isStacked) {
                                    // For stacked bar charts (daily charts), percentage of a language segment (e.g., PTBR M√©dias)
                                    // is relative to the TOTAL ACTIVE CALLS FOR THAT DAY.
                                    const chartId = tooltipItem.chart.canvas.id;
                                    totalForPercentage = dailyActiveTotals[chartId] || 0; // Use predefined total for the day
                                    labelText = dataset.label; // Language label (e.g., üáßüá∑ PTBR)
                                } else {
                                    // For non-stacked bar charts (qualityTrendChart), percentage is relative to the total active calls for that specific day.
                                    // Here, dataIndex is the index of the day (0, 1, 2)
                                    // Need to get the total for that specific day from dailyTotalsByDate
                                    const dateLabel = tooltipItem.chart.data.labels[dataIndex];
                                    const dateOnly = Array.isArray(dateLabel) ? dateLabel[0] : dateLabel;
                                    totalForPercentage = dailyTotalsByDate[dateOnly].total || 0;

                                    labelText = dataset.label; // Quality type label (e.g., 'Boas')
                                }
                            } else if (tooltipItem.chart.config.type === 'line') {
                                // For line charts, percentage is usually not applicable in the same way,
                                // but if needed, it would be relative to the dataset's total.
                                totalForPercentage = dataset.data.reduce((sum, val) => sum + val, 0);
                                labelText = dataset.label;
                            }

                            const percentage = totalForPercentage > 0 ? ((currentValue / totalForPercentage) * 100).toFixed(1) : 0;
                            return `${labelText}: ${currentValue} (${percentage}%)`;
                        }
                    }
                },
                legend: {
                    position: 'bottom',
                },
                datalabels: {
                    color: '#fff', // Cor padr√£o dos r√≥tulos
                    font: {
                        weight: 'bold',
                        size: 10
                    },
                    formatter: (value, context) => {
                        let totalForPercentage = 0;
                        const chart = context.chart;
                        const dataset = context.dataset;
                        const dataIndex = context.dataIndex;

                        if (chart.config.type === 'doughnut' || chart.config.type === 'pie') {
                            totalForPercentage = dataset.data.reduce((sum, val) => sum + val, 0);
                        } else if (chart.config.type === 'bar') {
                            const scalesOptions = chart.options.scales;
                            const xAxisOptions = scalesOptions && scalesOptions.x ? scalesOptions.x : undefined; // Acessa x de forma segura
                            const isStacked = xAxisOptions ? xAxisOptions.stacked : false; // Acessa stacked de forma segura

                            if (isStacked) {
                                // For stacked bar charts (daily charts), percentage of a language segment
                                // is relative to the TOTAL ACTIVE CALLS FOR THAT DAY.
                                const chartId = chart.canvas.id;
                                totalForPercentage = dailyActiveTotals[chartId] || 0;
                            } else {
                                // For non-stacked bar charts (qualityTrendChart), percentage is relative to the total of all quality types for that specific day.
                                // Here, dataIndex is the index of the day (0, 1, 2)
                                const dateLabel = chart.data.labels[dataIndex];
                                const dateOnly = Array.isArray(dateLabel) ? dateLabel[0] : dateLabel;
                                totalForPercentage = dailyTotalsByDate[dateOnly].total || 0;
                            }
                        } else if (chart.config.type === 'line') {
                            // For line charts, datalabels usually show just the value or total, not percentage of a segment.
                            return value;
                        }

                        const percentage = totalForPercentage > 0 ? ((value / totalForPercentage) * 100).toFixed(1) : 0;
                        return `${value} (${percentage}%)`;
                    },
                    display: function(context) {
                        // Esconde r√≥tulos para valores zero ou para gr√°ficos de linha onde n√£o faz sentido
                        return context.dataset.data[context.dataIndex] !== 0 && context.chart.config.type !== 'line';
                    },
                    // Ajuste de posi√ß√£o para gr√°ficos de barra
                    anchor: 'center',
                    align: 'center',
                }
            },
        };

        // Gr√°ficos
        new Chart(document.getElementById('overallQualityChart'), {
            type: 'doughnut',
            data: overallQualityData,
            options: { ...commonChartOptions }
        });

        // Gr√°ficos Di√°rios
        new Chart(document.getElementById('dailyChart15'), {
            type: 'bar',
            data: dailyChartData15,
            options: { ...commonChartOptions, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        new Chart(document.getElementById('dailyChart16'), {
            type: 'bar',
            data: dailyChartData16,
            options: { ...commonChartOptions, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        new Chart(document.getElementById('dailyChart17'), {
            type: 'bar',
            data: dailyChartData17,
            options: { ...commonChartOptions, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        // Novo gr√°fico para o dia 18
        new Chart(document.getElementById('dailyChart18'), {
            type: 'bar',
            data: dailyChartData18,
            options: { ...commonChartOptions, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        // Novo gr√°fico para o dia 21
        new Chart(document.getElementById('dailyChart21'), {
            type: 'bar',
            data: dailyChartData21,
            options: { ...commonChartOptions, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        // Gr√°fico de Tend√™ncia de Volume (datalabels desativados para linha)
        new Chart(document.getElementById('totalCallsTrendChart'), {
            type: 'line',
            data: totalCallsTrendData,
            options: { 
                ...commonChartOptions, 
                plugins: { 
                    ...commonChartOptions.plugins, 
                    legend: { display: false },
                    datalabels: { display: false } // Desativa datalabels para este gr√°fico
                } 
            }
        });

        // Comparativo de Qualidade por Dia (Ativas)
        new Chart(document.getElementById('qualityTrendChart'), {
            type: 'bar',
            data: qualityTrendData,
            options: {
                ...commonChartOptions,
                scales: { x: {}, y: {} },
                plugins: {
                    ...commonChartOptions.plugins, // Mant√©m outras configura√ß√µes de plugins comuns
                    datalabels: {
                        color: '#333', // Cor dos r√≥tulos para contraste fora da barra
                        font: {
                            weight: 'bold',
                            size: 9 // Reduzir um pouco mais a fonte para melhor encaixe
                        },
                        padding: 0,
                        formatter: (value, context) => {
                            let totalForPercentage = 0;
                            const chart = context.chart;
                            const dataIndex = context.dataIndex; // Este √© o √≠ndice do dia

                            // Soma todos os tipos de qualidade para o dia atual (dataIndex)
                            chart.data.datasets.forEach(ds => {
                                if (ds.data && ds.data[dataIndex] !== undefined) {
                                    totalForPercentage += ds.data[dataIndex];
                                }
                            });

                            const percentage = totalForPercentage > 0 ? ((value / totalForPercentage) * 100).toFixed(1) : 0;
                            return `${value}\n(${percentage}%)`; // Formato com quebra de linha
                        },
                        display: function(context) {
                            return context.dataset.data[context.dataIndex] !== 0; // Exibe apenas para valores n√£o-zero
                        },
                        anchor: 'end', // Posiciona o r√≥tulo no final (topo) da barra
                        align: 'center', // Alinha o r√≥tulo ao centro horizontalmente
                        offset: 4, // Adiciona um pequeno offset para fora da barra
                    }
                }
            }
        });

        // Distribui√ß√£o de Idiomas (Chamadas Boas)
        new Chart(document.getElementById('goodCallsLangChart'), {
            type: 'pie',
            data: goodCallsLangData,
            options: { ...commonChartOptions }
        });

        // Fun√ß√£o para obter a abrevia√ß√£o do dia da semana
        function getDayAbbreviation(dateString) {
            const date = new Date(`2025-${dateString.substring(3,5)}-${dateString.substring(0,2)}T12:00:00`); // Ano fixo para 2025
            const days = ['DOM', 'SEG', 'TER', 'QUA', 'QUI', 'SEX', 'SAB'];
            return days[date.getDay()];
        }

        // Adicionar os √≠cones dos dias da semana dinamicamente
        document.addEventListener('DOMContentLoaded', () => {
            const dailyAnalysisBoxes = document.querySelectorAll('#daily-analysis .bg-white.rounded-lg.shadow-md.p-6');
            const dates = ['15/07', '16/07', '17/07', '18/07', '21/07']; // Ordem dos dias

            dailyAnalysisBoxes.forEach((box, index) => {
                const date = dates[index];
                const dayAbbr = getDayAbbreviation(date);
                const dayIconDiv = document.createElement('div');
                dayIconDiv.classList.add('day-icon');
                dayIconDiv.textContent = dayAbbr;
                box.appendChild(dayIconDiv);
            });
        });
    </script>
</body>
</html>
